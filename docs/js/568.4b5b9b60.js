(globalThis["webpackChunklive_frame_webapp"]=globalThis["webpackChunklive_frame_webapp"]||[]).push([[568],{5648:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>pe});var i=s(9835);const o={key:0,class:"flex full-width flex-center"};function n(e,t,s,n,l,r){const a=(0,i.up)("photo-select"),c=(0,i.up)("upload-item"),d=(0,i.up)("q-list"),u=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(u,{class:"flex flex-row"},{default:(0,i.w5)((()=>[0===e.tasks.length?((0,i.wg)(),(0,i.iD)("div",o,[(0,i.Wm)(a,{onFilesSelected:e.onFilesSelected,maxSize:e.config.maxFileSize},null,8,["onFilesSelected","maxSize"])])):((0,i.wg)(),(0,i.j4)(d,{key:1,bordered:"",class:"full-width"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.tasks,(t=>((0,i.wg)(),(0,i.j4)(c,{key:t.id,task:t,onRemove:e.removeTask},null,8,["task","onRemove"])))),128))])),_:1}))])),_:1})}var l=s(499);const r=JSON.parse('{"maxFileSize":10000000}');var a=s(1957);const c={class:"full-width q-px-lg"},d={style:{"background-color":"white"}},u={id:"dialog-content",class:"q-gutter-y-md q-pa-sm"},m={class:"flex row full-width"},h={class:"full-width flex",style:{height:"100%"}},p=["src"];function f(e,t,s,o,n,l){const r=(0,i.up)("q-file"),f=(0,i.up)("q-btn"),g=(0,i.up)("q-space"),k=(0,i.up)("q-img"),y=(0,i.up)("q-carousel-control"),b=(0,i.up)("q-carousel-slide"),w=(0,i.up)("q-carousel"),v=(0,i.up)("q-input"),I=(0,i.up)("q-dialog");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",c,[(0,i.wy)((0,i.Wm)(r,{class:"q-mt-lg",ref:"upload",modelValue:e.model,"onUpdate:modelValue":t[0]||(t[0]=t=>e.model=t),onInput:e.onFilesSelected,"max-file-size":e.maxSize,multiple:"",accept:"video/*, image/*"},null,8,["modelValue","onInput","max-file-size"]),[[a.F8,!1]]),(0,i.Wm)(f,{label:e.label,icon:"mdi-upload",onClick:e.onClickSelect,class:"full-width",color:"primary",style:{height:"3.5em"}},null,8,["label","onClick"])]),(0,i.Wm)(I,{modelValue:e.showDialog,"onUpdate:modelValue":t[7]||(t[7]=t=>e.showDialog=t),persistent:"",maximized:!0,"transition-show":"jump-up","transition-hide":"slide-left"},{default:(0,i.w5)((()=>[(0,i._)("div",d,[(0,i._)("div",u,[(0,i._)("div",m,[(0,i.Wm)(f,{dense:"",flat:"",icon:"mdi-close",onClick:t[1]||(t[1]=()=>e.showDialog=!1)}),(0,i.Wm)(g),(0,i.Wm)(f,{dense:"",flat:"",label:"Sent",onClick:e.onClickSent},null,8,["onClick"])]),(0,i.Wm)(w,{style:{height:"100%"},swipeable:"",animated:"",modelValue:e.slideIndex,"onUpdate:modelValue":[t[4]||(t[4]=t=>e.slideIndex=t),t[5]||(t[5]=()=>e.componentRefs["descriptionBox"].focus())],ref:"carousel"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.files,((s,o)=>((0,i.wg)(),(0,i.j4)(b,{key:o,name:o,class:"q-pa-none"},{default:(0,i.w5)((()=>[(0,i._)("div",h,[s.isVideo?((0,i.wg)(),(0,i.iD)("video",{key:0,controls:"",muted:"",class:"full-width",src:s.objectURL},null,8,p)):(0,i.kq)("",!0),s.isImage?((0,i.wg)(),(0,i.j4)(k,{key:1,class:"full-width",src:s.objectURL,fit:"contain",style:{"max-height":"100%"}},null,8,["src"])):(0,i.kq)("",!0)]),(0,i.Wm)(y,{position:"bottom-right",offset:[18,18],class:"q-gutter-xs"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{push:"",round:"",dense:"",color:"orange","text-color":"black",icon:"mdi-menu-left",onClick:t[2]||(t[2]=t=>e.componentRefs["carousel"].previous()),disable:0===e.slideIndex},null,8,["disable"]),(0,i.Wm)(f,{push:"",round:"",dense:"",color:"orange","text-color":"black",icon:"mdi-menu-right",onClick:t[3]||(t[3]=t=>e.componentRefs["carousel"].next()),disable:e.slideIndex===e.files.length-1},null,8,["disable"])])),_:1})])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"]),(0,i._)("div",null,[e.files[e.slideIndex]?((0,i.wg)(),(0,i.j4)(v,{key:0,ref:"descriptionBox",autocomplete:"false",autofocus:"",autocapitalize:"true",spellcheck:"true",label:"Beschrijving",modelValue:e.files[e.slideIndex].comment,"onUpdate:modelValue":t[6]||(t[6]=t=>e.files[e.slideIndex].comment=t)},null,8,["modelValue"])):(0,i.kq)("",!0)])])])])),_:1},8,["modelValue"])],64)}const g=(0,i.aZ)({props:{maxSize:{type:Number,default:void 0},label:{type:String,default:"Selecteer bestanden"}},emits:["filesSelected"],setup(){const e=(0,l.iH)([]);return{model:(0,l.iH)(null),showDialog:(0,l.iH)(!1),slideIndex:(0,l.iH)(0),files:e}},methods:{onFilesSelected(e){var t;const s=e.target,i=Array.from(null!==(t=s.files)&&void 0!==t?t:[]);if(!i.length)return;const o=[];this.files=i.filter((e=>{const t=void 0===this.maxSize||e.size<=this.maxSize;return t||o.push(e.name),t})).map((e=>{const t={blob:e,objectURL:URL.createObjectURL(e),isVideo:0===e.type.toLowerCase().indexOf("video/"),isImage:0===e.type.toLowerCase().indexOf("image/"),comment:""};return t})),i.forEach((()=>this.upload.removeAtIndex(0))),o.length>0&&alert(`Bestand\n${o.join("\n")}\nis te groot.`),0!==this.files.length&&(this.showDialog=!0)},onClickSelect(){this.upload.pickFiles()},onClickSent(){this.files.length>0&&this.$emit("filesSelected",[...this.files]),this.showDialog=!1}},computed:{componentRefs(){return this.$refs},upload(){return this.componentRefs["upload"]}}});var k=s(1639),y=s(9420),b=s(4455),w=s(4535),v=s(136),I=s(960),x=s(1694),N=s(335),D=s(33),_=s(4152),S=s(9984),E=s.n(S);const q=(0,k.Z)(g,[["render",f],["__scopeId","data-v-30350da9"]]),P=q;E()(g,"components",{QFile:y.Z,QBtn:b.Z,QDialog:w.Z,QSpace:v.Z,QCarousel:I.Z,QCarouselSlide:x.Z,QImg:N.Z,QCarouselControl:D.Z,QInput:_.Z});var C=s(4308),F=s(4844),R=s.n(F),Z=s(3830),j=s(270),G=s(147),T=s(5854),U=function(e,t,s,i){function o(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,n){function l(e){try{a(i.next(e))}catch(t){n(t)}}function r(e){try{a(i["throw"](e))}catch(t){n(t)}}function a(e){e.done?s(e.value):o(e.value).then(l,r)}a((i=i.apply(e,t||[])).next())}))};function L(e){const t=e.replace(/(\r\n|\n|\r)/gm,"").replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").trim();return j.Buffer.from(R().crypto_generichash(32,t)).toString("hex").toLocaleLowerCase()}class z{encrypt(e){return new Promise(((t,s)=>U(this,void 0,void 0,(function*(){const i=yield this._JSEncrypt,o=j.Buffer.from(e).toString("hex"),n=i.encrypt(o);if(!1===n)return void s("Cannot encrypt the key");const l=new Uint8Array(j.Buffer.from(n,"base64").buffer);t(l)}))))}constructor(){this.publicKey=new Promise(((e,t)=>U(this,void 0,void 0,(function*(){console.debug("download public key");const s=(0,Z.K)(),i=s.storage,o=(0,G.iH)(i,"public.pem");(0,G.Pw)(o).then((t=>{const s=j.Buffer.from(t).toString("utf8"),i=L(s);console.debug("Retrieved public key",s),console.debug("Key id",i),e({data:s,keyId:i})})).catch((e=>{console.error("Cannot get public key",e),t(e)}))})))),this._JSEncrypt=new Promise(((e,t)=>U(this,void 0,void 0,(function*(){try{const t=yield this.publicKey,s=new T.Z;s.setPublicKey(t.data),e(s)}catch(s){t(s)}})))),this.encrypt=this.encrypt.bind(this)}}const A=new z,W=()=>A;var B,O=function(e,t,s,i){function o(e){return e instanceof s?e:new s((function(t){t(e)}))}return new(s||(s=Promise))((function(s,n){function l(e){try{a(i.next(e))}catch(t){n(t)}}function r(e){try{a(i["throw"](e))}catch(t){n(t)}}function a(e){e.done?s(e.value):o(e.value).then(l,r)}a((i=i.apply(e,t||[])).next())}))};(function(e){e[e["PENDING"]=0]="PENDING",e[e["READING"]=1]="READING",e[e["ENCRYPTING"]=2]="ENCRYPTING",e[e["UPLOADING"]=3]="UPLOADING",e[e["DONE"]=4]="DONE"})(B||(B={}));class Q{constructor(e){this.id=(0,C.Z)(),this.stage=B.PENDING,this.bytesRead=0,this.isError=!1,this.errorMessage="",this.file=e}}const V=e=>j.Buffer.from(e).toString("base64"),H=e=>{const t=R().randombytes_buf(R().crypto_secretbox_NONCEBYTES),s=R().crypto_secretstream_xchacha20poly1305_keygen(),i=V(e),o=R().crypto_secretbox_easy(i,t,s),n=R().crypto_generichash(32,i);return{key:s,nonce:t,data:o,checksum:n}},K=e=>{const t=Object.keys(e),s={};return t.forEach((t=>{const i=e[t];s[t]=V(i)})),JSON.stringify(s)};class Y{readFile(e){return e.stage=B.READING,console.debug("fase-read"),new Promise(((t,s)=>{const i=new FileReader;i.onload=s=>O(this,void 0,void 0,(function*(){console.debug("read-finished"),e.bytesRead=s.loaded,t(i.result)})),i.onloadstart=t=>{console.debug("read-progress"),e.bytesRead=t.loaded},i.onprogress=t=>{console.debug("read-progress"),e.bytesRead=t.loaded},i.onerror=()=>{var t,o;console.debug("read-error"),e.errorMessage=null!==(o=null===(t=i.error)||void 0===t?void 0:t.message)&&void 0!==o?o:"Error reading file.",s()},i.abort=()=>{console.debug("read-error"),e.errorMessage="Aborted",s()},i.readAsArrayBuffer(e.file.blob)}))}encryptFile(e,t){return O(this,void 0,void 0,(function*(){return e.stage=B.ENCRYPTING,console.debug("fase-encrypt"),new Promise(((e,s)=>O(this,void 0,void 0,(function*(){try{const s=W();console.debug("encrypt-create-message");const i=H(t);console.debug("encrypt-secure-key"),i.key=yield s.encrypt(i.key),console.debug("encrypt-encode");const o=K(i);console.debug("encrypt-done"),e(o)}catch(i){console.error(i),s(i)}}))))}))}pushFile(e,t){var s,i;return O(this,void 0,void 0,(function*(){e.stage=B.UPLOADING;const o=(0,Z.K)(),n=W(),l=o.storage,r=(0,C.Z)()+".blob",a=(0,G.iH)(l,"uploads/"+r),c=(yield n.publicKey).keyId;return(0,G.sf)(a,t,void 0,{customMetadata:{uploader:null!==(i=null===(s=o.user)||void 0===s?void 0:s.uid)&&void 0!==i?i:"unknown",lastModified:e.file.blob.lastModified.toString(),comment:e.file.comment,keyId:c},contentType:e.file.blob.type})}))}run(e){return O(this,void 0,void 0,(function*(){const t=yield this.readFile(e);if(null==t)throw new Error("Cannot read file");const s=yield this.encryptFile(e,t);yield this.pushFile(e,s),e.stage=B.DONE}))}startTask(e){this.run(e).then((()=>this.fireTaskFinished(e))).catch((t=>{var s;e.isError=!0,e.errorMessage=null!==(s=null===t||void 0===t?void 0:t.message)&&void 0!==s?s:"onbekend",this.fireTaskFinished(e)}))}fireTaskFinished(e){var t;null===(t=this.onTaskFinished)||void 0===t||t.apply(this,[e])}constructor(){this.startTask=this.startTask.bind(this),this.encryptFile=this.encryptFile.bind(this),this.fireTaskFinished=this.fireTaskFinished.bind(this),this.pushFile=this.pushFile.bind(this),this.readFile=this.readFile.bind(this),this.run=this.run.bind(this)}}var M=s(6970);const $=["src"],J=["src"],X={class:"text-weight-medium"},ee={class:"text-grey-8 q-gutter-xs"};function te(e,t,s,o,n,l){const r=(0,i.up)("q-item-section"),a=(0,i.up)("q-item-label"),c=(0,i.up)("q-linear-progress"),d=(0,i.up)("q-circular-progress"),u=(0,i.up)("q-btn"),m=(0,i.up)("q-item");return(0,i.wg)(),(0,i.j4)(m,{active:e.taskIsActive,style:{"border-bottom":"1px solid rgba(75, 75, 75, 0.3)"},class:"q-py-md"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{avatar:"",top:""},{default:(0,i.w5)((()=>[e.task.file.isImage?((0,i.wg)(),(0,i.iD)("img",{key:0,src:e.task.file.objectURL,style:{width:"100px",height:"100px","object-fit":"contain","object-position":"center"}},null,8,$)):((0,i.wg)(),(0,i.iD)("video",{key:1,src:e.task.file.objectURL,style:{width:"100px",height:"100px","object-fit":"contain","object-position":"center"}},null,8,J))])),_:1}),(0,i.Wm)(r,{top:"",class:"col-2 gt-sm"},{default:(0,i.w5)((()=>[(0,i.Wm)(a,{class:"q-mt-sm"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,M.zw)(e.task.file.blob.name),1)])),_:1}),(0,i.Wm)(a,{class:"q-mt-sm"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,M.zw)(e.task.file.comment),1)])),_:1})])),_:1}),(0,i.Wm)(r,{top:""},{default:(0,i.w5)((()=>[(0,i.Wm)(a,{lines:"1"},{default:(0,i.w5)((()=>[(0,i._)("span",X,(0,M.zw)(e.getStageName(e.task.stage)),1)])),_:1}),(0,i.Wm)(c,{value:e.progress/100,class:"q-mt-md"},null,8,["value"]),e.taskIsActive?((0,i.wg)(),(0,i.j4)(d,{key:0,indeterminate:"",size:"50px",color:"lime",class:"q-ma-md"})):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(r,{top:"",side:""},{default:(0,i.w5)((()=>[(0,i._)("div",ee,[e.taskIsPending?((0,i.wg)(),(0,i.j4)(u,{key:0,size:"12px",flat:"",dense:"",round:"",icon:"mdi-delete",onClick:t[0]||(t[0]=()=>e.$emit("remove",e.task))})):(0,i.kq)("",!0),e.taskIsDone?((0,i.wg)(),(0,i.j4)(u,{key:1,size:"12px",flat:"",dense:"",round:"",icon:"mdi-close",onClick:t[1]||(t[1]=()=>e.$emit("remove",e.task))})):(0,i.kq)("",!0)])])),_:1})])),_:1},8,["active"])}const se=(0,i.aZ)({props:{task:{type:Q,required:!0}},emits:["remove"],methods:{getStageName(e){switch(e){case B.PENDING:return"Klaar voor verwerking";case B.READING:return"Bestand lezen...";case B.ENCRYPTING:return"Versleutelen...";case B.UPLOADING:return"Bestand uploaden...";case B.DONE:return"Afgerond";default:return"??"}}},computed:{taskIsPending(){return this.task.stage===B.PENDING},taskIsActive(){return!(this.taskIsPending||this.taskIsDone)},taskIsDone(){return this.task.stage===B.DONE},progress(){switch(this.task.stage){case B.PENDING:return 0;case B.READING:return 20;case B.ENCRYPTING:return 60;case B.UPLOADING:return 80;case B.DONE:return 100;default:return 0}}}});var ie=s(490),oe=s(1233),ne=s(3115),le=s(8289),re=s(3302);const ae=(0,k.Z)(se,[["render",te]]),ce=ae;E()(se,"components",{QItem:ie.Z,QItemSection:oe.Z,QItemLabel:ne.Z,QLinearProgress:le.Z,QCircularProgress:re.Z,QBtn:b.Z});const de=(0,i.aZ)({components:{PhotoSelect:P,UploadItem:ce},setup(){const e=new Y,t=(0,l.iH)([]);return e.onTaskFinished=()=>{const s=t.value.find((e=>e.stage===B.PENDING));void 0!==s&&e.startTask(s)},{config:r,tasks:t,taskHandler:e}},methods:{onFilesSelected(e){e.forEach((e=>{const t=new Q(e);this.tasks.push(t)}));const t=this.tasks.find((()=>!0));void 0!==t&&this.taskHandler.startTask(t)},removeTask(e){const t=this.tasks.findIndex((t=>t.id===e.id));t<0||this.tasks.splice(t,1)}},computed:{}});var ue=s(9885),me=s(3246);const he=(0,k.Z)(de,[["render",n]]),pe=he;E()(de,"components",{QPage:ue.Z,QList:me.Z})},950:()=>{},6601:()=>{},9214:()=>{},8623:()=>{},7748:()=>{},5568:()=>{},5992:()=>{},8110:()=>{},6619:()=>{},7108:()=>{},2361:()=>{},4616:()=>{}}]);